(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2610],{29445:function(e,t,i){"use strict";i.d(t,{Z:function(){return n}});let n=(0,i(91373).Z)("printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]])},94933:function(e,t,i){"use strict";i.d(t,{Z:function(){return n}});let n=(0,i(91373).Z)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},92956:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/orders/[id]",function(){return i(31708)}])},31708:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return C}});var n=i(85893),o=i(69554),r=i.n(o),l=i(11163),s=i(67294),a=i(64552),d=i(91373);let c=(0,d.Z)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);var p=i(42297);let x=(0,d.Z)("ban",[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),m=(0,d.Z)("undo-2",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]]);var h=i(29445),u=i(13025),g=i(73510),y=i(28463),f=i(94933),j=i(19769);let b=(0,d.Z)("credit-card",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);var v=i(54976),w=i(28761),E=i(45077),k=i(64248),B=i(89508);let S={initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1,transition:{duration:.2,ease:"easeOut"}},exit:{opacity:0,scale:.96,transition:{duration:.15,ease:"easeIn"}}};function C(){var e,t,i,o,r,d,C,T,I;let A=(0,l.useRouter)(),{id:R}=A.query,[N,O]=(0,s.useState)(null),[L,_]=(0,s.useState)(!0),[Z,W]=(0,s.useState)(!1),[P,M]=(0,s.useState)(!1),[H,V]=(0,s.useState)({type:null,open:!1}),[q,U]=(0,s.useState)("");(0,s.useEffect)(()=>{R&&G()},[R]);let G=async()=>{_(!0);try{let t=localStorage.getItem("admin_token"),i={"Content-Type":"application/json",...t?{Authorization:"Bearer ".concat(t)}:{}},n=await fetch("".concat("","/api/orders/admin/").concat(R),{headers:i,credentials:"include"});if(n.ok){let e=await n.json();e.success&&O(e.order)}else{var e;let t=await fetch("".concat("","/api/orders/admin/all"),{headers:i,credentials:"include"}),n=await t.json(),o=null===(e=n.orders)||void 0===e?void 0:e.find(e=>e.orderId===R||e._id===R);O(o)}}catch(e){console.error(e)}finally{_(!1)}},Y=async()=>{if(null==N?void 0:N.orderId){M(!0);try{let e=localStorage.getItem("admin_token"),t=await fetch("".concat("","/api/orders/admin/orders/refresh-tracking"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({orderIds:[N.orderId]}),credentials:"include"});(await t.json()).success?G():alert("Tracking refresh failed")}catch(e){console.error(e)}finally{M(!1)}}},J=async()=>{if(!q&&"RTO"===H.type)return alert("Reason is mandatory for RTO");W(!0);try{let e=localStorage.getItem("admin_token"),t="CANCEL"===H.type?"cancel":"rto",i=await fetch("".concat("","/api/orders/admin/").concat(N._id,"/").concat(t),{method:"POST",headers:{"Content-Type":"application/json",...e?{Authorization:"Bearer ".concat(e)}:{}},credentials:"include",body:JSON.stringify({reason:q})}),n=await i.json();n.success?(alert(n.message),V({type:null,open:!1}),U(""),G()):alert(n.message||"Action failed")}catch(e){console.error(e),alert("Network Error")}finally{W(!1)}};if(L)return(0,n.jsx)(a.Z,{children:(0,n.jsx)("div",{style:{height:"80vh",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,n.jsx)("h2",{style:{color:"#6B7280"},children:"Loading Order Details..."})})});if(!N)return(0,n.jsx)(a.Z,{children:(0,n.jsxs)("div",{style:{padding:40,textAlign:"center"},children:[(0,n.jsx)("h2",{children:"Order not found"}),(0,n.jsx)("button",{onClick:()=>A.push("/admin/orders"),style:z.btnSec,children:"Back to Orders"})]})});let K=(null===(t=N.shipping)||void 0===t?void 0:null===(e=t.logs)||void 0===e?void 0:e.sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp)))||[],X=["PENDING_SHIPMENT","PACKED"].includes(N.status),Q=["SHIPPED","ON_THE_WAY","OUT_FOR_DELIVERY"].includes(N.status);return(0,n.jsxs)(a.Z,{children:[(0,n.jsxs)(k.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[(0,n.jsxs)("header",{style:z.header,className:"admin-header",children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16},children:[(0,n.jsx)("button",{onClick:()=>A.push("/admin/orders"),style:z.backBtn,children:(0,n.jsx)(c,{size:20})}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,n.jsxs)("h1",{style:z.title,children:["Order #",N.orderId]}),(0,n.jsx)(D,{status:N.status})]}),(0,n.jsxs)("div",{style:z.meta,children:["Placed on ",new Date(N.createdAt).toLocaleString(),(null===(i=N.shipping)||void 0===i?void 0:i.lastSync)&&(0,n.jsxs)("span",{style:{marginLeft:8,color:"#10B981",display:"inline-flex",alignItems:"center",gap:4},children:["• Live Synced ",Math.floor((Date.now()-new Date(N.shipping.lastSync).getTime())/6e4),"m ago"]})]})]})]}),(0,n.jsxs)("div",{style:z.actions,className:"admin-actions",children:[(null===(o=N.shipping)||void 0===o?void 0:o.awbNumber)&&(0,n.jsxs)("button",{onClick:Y,disabled:P,style:z.btnSec,children:[(0,n.jsx)(p.Z,{size:16,className:P?"spin":""}),P?"Syncing...":"Refresh"]}),X&&(0,n.jsxs)("button",{onClick:()=>V({type:"CANCEL",open:!0}),style:z.btnDanger,children:[(0,n.jsx)(x,{size:16})," Cancel Order"]}),Q&&(0,n.jsxs)("button",{onClick:()=>V({type:"RTO",open:!0}),style:z.btnWarning,children:[(0,n.jsx)(m,{size:16})," Initiate RTO"]}),(0,n.jsxs)("button",{onClick:()=>window.open("/admin/orders/".concat(N.orderId,"/invoice"),"_blank"),style:z.btnSec,children:[(0,n.jsx)(h.Z,{size:16})," Invoice"]}),(null===(r=N.shipping)||void 0===r?void 0:r.labelUrl)&&(0,n.jsxs)("button",{onClick:()=>window.open(N.shipping.labelUrl,"_blank"),style:z.btnMain,children:[(0,n.jsx)(u.Z,{size:16})," Shipping Label"]})]})]}),"CANCELLED"===N.status&&(0,n.jsx)("div",{style:z.errorBanner,children:(0,n.jsxs)("div",{style:{display:"flex",gap:12},children:[(0,n.jsx)(g.Z,{size:20}),(0,n.jsxs)("div",{children:[(0,n.jsx)("b",{children:"Order Cancelled"}),(0,n.jsxs)("div",{style:{fontSize:13,marginTop:4},children:["By ",null===(d=N.cancellation)||void 0===d?void 0:d.cancelledBy," on ",new Date(null===(C=N.cancellation)||void 0===C?void 0:C.cancelledAt).toLocaleString(),(0,n.jsx)("br",{}),"Reason: ",(null===(T=N.cancellation)||void 0===T?void 0:T.reason)||"N/A"]})]})]})}),"RTO_INITIATED"===N.status&&(0,n.jsx)("div",{style:z.warningBanner,children:(0,n.jsxs)("div",{style:{display:"flex",gap:12},children:[(0,n.jsx)(m,{size:20}),(0,n.jsxs)("div",{children:[(0,n.jsx)("b",{children:"RTO Initiated"}),(0,n.jsxs)("div",{style:{fontSize:13,marginTop:4},children:["Reason: ",null===(I=N.rto)||void 0===I?void 0:I.reason]})]})]})}),(0,n.jsxs)("div",{style:z.grid,className:"admin-grid",children:[(0,n.jsxs)("div",{style:z.col,children:[(0,n.jsxs)("section",{style:z.card,className:"admin-card",children:[(0,n.jsxs)("h3",{style:z.cardTitle,children:[(0,n.jsx)(y.Z,{size:18,style:{color:"#6B7280"}})," Order Items"]}),(0,n.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:16},children:N.items.map((e,t)=>(0,n.jsxs)("div",{style:z.itemRow,children:[(0,n.jsxs)("div",{style:{flex:1},children:[(0,n.jsx)("div",{style:z.itemName,children:e.variant}),(0,n.jsxs)("div",{style:z.itemMeta,children:["Qty: ",e.quantity," \xd7 ₹",e.price]})]}),(0,n.jsxs)("div",{style:z.itemTotal,children:["₹",e.quantity*e.price]})]},t))}),(0,n.jsx)("div",{style:z.divider}),(0,n.jsxs)("div",{style:z.pricingRow,children:[(0,n.jsx)("span",{children:"Subtotal"}),(0,n.jsxs)("span",{children:["₹",N.pricing.subtotal]})]}),(0,n.jsxs)("div",{style:z.pricingRow,children:[(0,n.jsx)("span",{children:"Discount"}),(0,n.jsxs)("span",{style:{color:"#059669"},children:["- ₹",N.pricing.discount]})]}),(0,n.jsxs)("div",{style:z.pricingRow,children:[(0,n.jsx)("span",{children:"COD Fee"}),(0,n.jsxs)("span",{children:["+ ₹",N.pricing.codFee]})]}),(0,n.jsxs)("div",{style:z.totalRow,children:[(0,n.jsx)("span",{children:"Total Amount"}),(0,n.jsxs)("span",{children:["₹",N.pricing.total]})]})]}),(0,n.jsxs)("section",{style:z.card,className:"admin-card",children:[(0,n.jsxs)("h3",{style:z.cardTitle,children:[(0,n.jsx)(f.Z,{size:18,style:{color:"#6B7280"}})," Customer Details"]}),(0,n.jsxs)("div",{style:z.detailGrid,children:[(0,n.jsxs)("div",{style:z.detailItem,children:[(0,n.jsx)("span",{style:z.detailLabel,children:"Name"}),(0,n.jsx)("span",{style:z.detailValue,children:N.customer.name})]}),(0,n.jsxs)("div",{style:z.detailItem,children:[(0,n.jsx)("span",{style:z.detailLabel,children:"Contact"}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,n.jsx)(j.Z,{size:14,color:"#6B7280"}),(0,n.jsx)("span",{style:z.detailValue,children:N.customer.phone})]})]}),(0,n.jsxs)("div",{style:z.detailItem,children:[(0,n.jsx)("span",{style:z.detailLabel,children:"Payment Method"}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,n.jsx)(b,{size:14,color:"#6B7280"}),(0,n.jsx)("span",{style:z.detailValue,children:N.paymentMethod})]})]})]})]}),(0,n.jsxs)("section",{style:z.card,className:"admin-card",children:[(0,n.jsxs)("h3",{style:z.cardTitle,children:[(0,n.jsx)(v.Z,{size:18,style:{color:"#6B7280"}})," Delivery Address"]}),(0,n.jsxs)("div",{style:z.addressBox,children:[N.customer.address,(0,n.jsx)("br",{}),(0,n.jsxs)("strong",{children:["Pincode: ",N.customer.pincode]})]})]})]}),(0,n.jsx)("div",{style:z.col,children:(0,n.jsxs)("section",{style:z.card,className:"admin-card",children:[(0,n.jsxs)("h3",{style:z.cardTitle,children:[(0,n.jsx)(w.Z,{size:18,style:{color:"#6B7280"}})," Shipment Timeline"]}),0===K.length?(0,n.jsxs)("div",{style:z.emptyState,children:[(0,n.jsx)(E.Z,{size:32,color:"#D1D5DB"}),(0,n.jsx)("p",{children:"No shipment updates yet."})]}):(0,n.jsx)("div",{style:z.timeline,children:K.map((e,t)=>(0,n.jsxs)("div",{style:z.timelineItem,children:[(0,n.jsx)("div",{style:z.timelineLine(t===K.length-1)}),(0,n.jsx)("div",{style:z.timelineDot(0===t)}),(0,n.jsxs)("div",{style:{flex:1},children:[(0,n.jsx)("div",{style:z.logStatus,children:e.status}),(0,n.jsx)("div",{style:z.logDesc,children:e.description}),(0,n.jsx)("div",{style:z.logTime,children:new Date(e.timestamp).toLocaleString()})]})]},t))})]})})]})]}),(0,n.jsx)(B.M,{children:H.open&&(0,n.jsx)("div",{style:z.modalOverlay,children:(0,n.jsxs)(k.E.div,{variants:S,initial:"initial",animate:"animate",exit:"exit",style:z.modalBox,children:[(0,n.jsx)("h3",{style:z.modalTitle,children:"CANCEL"===H.type?"Cancel Order":"Initiate RTO"}),(0,n.jsx)("p",{style:z.modalDesc,children:"CANCEL"===H.type?"Are you sure? This action will cancel the order and cannot be undone.":"Please provide a reason for initiating RTO for this shipment."}),(0,n.jsxs)("div",{style:{marginBottom:20},children:[(0,n.jsx)("label",{style:z.inputLabel,children:"Reason for action"}),(0,n.jsxs)("select",{style:z.select,value:q,onChange:e=>U(e.target.value),children:[(0,n.jsx)("option",{value:"",children:"Select Reason..."}),"CANCEL"===H.type?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("option",{value:"Customer Request",children:"Customer Request"}),(0,n.jsx)("option",{value:"Duplicate Object",children:"Duplicate Order"}),(0,n.jsx)("option",{value:"Fraudulent",children:"Fraudulent / Suspicious"}),(0,n.jsx)("option",{value:"Out of Stock",children:"Out of Stock"}),(0,n.jsx)("option",{value:"Other",children:"Other"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("option",{value:"Customer Refused",children:"Customer Refused"}),(0,n.jsx)("option",{value:"Address Not Found",children:"Address Not Found"}),(0,n.jsx)("option",{value:"Customer Not Available",children:"Customer Not Available"}),(0,n.jsx)("option",{value:"Damaged",children:"Damaged"}),(0,n.jsx)("option",{value:"Other",children:"Other"})]})]})]}),(0,n.jsxs)("div",{style:z.modalActions,children:[(0,n.jsx)("button",{onClick:()=>V({type:null,open:!1}),style:z.btnSec,children:"Cancel"}),(0,n.jsx)("button",{onClick:J,disabled:Z||!q,style:"CANCEL"===H.type?z.btnDanger:z.btnWarning,children:Z?"Processing...":"Confirm Action"})]})]})})}),(0,n.jsx)(F,{})]})}let D=e=>{let{status:t}=e,i=(e=>{switch(e){case"DELIVERED":return{bg:"#ECFDF5",color:"#059669",border:"#A7F3D0"};case"CANCELLED":return{bg:"#FEF2F2",color:"#DC2626",border:"#FECACA"};case"SHIPPED":case"OUT_FOR_DELIVERY":return{bg:"#EFF6FF",color:"#2563EB",border:"#BFDBFE"};case"PACKED":return{bg:"#FFFBEB",color:"#D97706",border:"#FDE68A"};default:return{bg:"#F3F4F6",color:"#4B5563",border:"#E5E7EB"}}})(t);return(0,n.jsx)("span",{style:{padding:"4px 10px",borderRadius:6,fontSize:12,fontWeight:600,textTransform:"uppercase",background:i.bg,color:i.color,border:"1px solid ".concat(i.border),display:"inline-block"},children:t.replace(/_/g," ")})},F=()=>(0,n.jsx)(r(),{id:"5d0f814ade73ce85",children:"@media(max-width:768px){.admin-header{-webkit-box-orient:vertical!important;-webkit-box-direction:normal!important;-webkit-flex-direction:column!important;-moz-box-orient:vertical!important;-moz-box-direction:normal!important;-ms-flex-direction:column!important;flex-direction:column!important;-webkit-box-align:start!important;-webkit-align-items:flex-start!important;-moz-box-align:start!important;-ms-flex-align:start!important;align-items:flex-start!important;gap:20px!important}.admin-actions{width:100%;-webkit-flex-wrap:wrap!important;-ms-flex-wrap:wrap!important;flex-wrap:wrap!important;gap:12px!important}.admin-grid{grid-template-columns:1fr!important;gap:16px!important}.admin-card{padding:16px!important}.admin-actions button{-webkit-box-flex:1;-webkit-flex:1;-moz-box-flex:1;-ms-flex:1;flex:1;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;white-space:nowrap}}"}),z={header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:32},title:{fontSize:24,fontWeight:700,color:"#fff",margin:0,letterSpacing:"-0.5px"},meta:{fontSize:13,color:"#9CA3AF",marginTop:4},backBtn:{background:"white",border:"1px solid #E5E7EB",borderRadius:8,padding:8,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"#374151",transition:"all 0.2s","&:hover":{background:"#F9FAFB"}},actions:{display:"flex",gap:12},btnMain:{display:"flex",alignItems:"center",gap:8,background:"#111827",color:"#fff",padding:"8px 16px",borderRadius:8,border:"none",cursor:"pointer",fontWeight:500,fontSize:14},btnSec:{display:"flex",alignItems:"center",gap:8,background:"#fff",color:"#374151",padding:"8px 16px",borderRadius:8,border:"1px solid #E5E7EB",cursor:"pointer",fontWeight:500,fontSize:14},btnDanger:{display:"flex",alignItems:"center",gap:8,background:"#FEF2F2",color:"#DC2626",padding:"8px 16px",borderRadius:8,border:"1px solid #FECACA",cursor:"pointer",fontWeight:600,fontSize:14},btnWarning:{display:"flex",alignItems:"center",gap:8,background:"#FFFBEB",color:"#D97706",padding:"8px 16px",borderRadius:8,border:"1px solid #FDE68A",cursor:"pointer",fontWeight:600,fontSize:14},grid:{display:"grid",gridTemplateColumns:"1.8fr 1.2fr",gap:24,alignItems:"start"},col:{display:"flex",flexDirection:"column",gap:24},card:{background:"#fff",padding:24,borderRadius:16,border:"1px solid #E5E7EB",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},cardTitle:{fontSize:15,fontWeight:600,marginBottom:20,color:"#111827",display:"flex",alignItems:"center",gap:10,textTransform:"uppercase",letterSpacing:"0.5px"},itemRow:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",borderBottom:"1px solid #F3F4F6",paddingBottom:16,marginBottom:16,"&:last-child":{borderBottom:"none",paddingBottom:0,marginBottom:0}},itemName:{fontWeight:600,fontSize:15,color:"#111827",marginBottom:2},itemMeta:{fontSize:13,color:"#6B7280"},itemTotal:{fontWeight:600,color:"#111827",fontSize:15},divider:{height:1,background:"#E5E7EB",margin:"24px 0"},pricingRow:{display:"flex",justifyContent:"space-between",fontSize:14,marginBottom:10,color:"#4B5563"},totalRow:{display:"flex",justifyContent:"space-between",fontSize:16,fontWeight:700,marginTop:16,paddingTop:16,borderTop:"1px solid #E5E7EB",color:"#111827"},detailGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(140px, 1fr))",gap:20},detailItem:{display:"flex",flexDirection:"column",gap:4},detailLabel:{fontSize:12,color:"#6B7280",fontWeight:500,textTransform:"uppercase"},detailValue:{fontSize:14,fontWeight:600,color:"#111827"},addressBox:{background:"#F9FAFB",padding:16,borderRadius:8,fontSize:14,lineHeight:"1.6",color:"#374151"},timeline:{position:"relative",paddingLeft:8},timelineItem:{display:"flex",gap:16,paddingBottom:32,position:"relative"},timelineLine:e=>({position:"absolute",top:10,left:5,width:2,bottom:e?"auto":-10,height:e?0:"auto",background:"#E5E7EB"}),timelineDot:e=>({width:12,height:12,borderRadius:"50%",background:e?"#10B981":"#D1D5DB",zIndex:2,marginTop:6,border:"2px solid #fff",boxShadow:e?"0 0 0 2px #A7F3D0":"none"}),logStatus:{fontWeight:600,fontSize:14,color:"#111827"},logDesc:{fontSize:13,color:"#4B5563",marginTop:2,lineHeight:1.4},logTime:{fontSize:11,color:"#9CA3AF",marginTop:4},emptyState:{display:"flex",flexDirection:"column",alignItems:"center",gap:12,padding:"32px 0",color:"#9CA3AF",fontSize:14},errorBanner:{background:"#FEF2F2",border:"1px solid #FECACA",borderRadius:12,padding:16,marginBottom:24,color:"#991B1B"},warningBanner:{background:"#FFFBEB",border:"1px solid #FDE68A",borderRadius:12,padding:16,marginBottom:24,color:"#92400E"},modalOverlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:100},modalBox:{background:"#fff",padding:32,borderRadius:16,width:440,maxWidth:"90%",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1)"},modalTitle:{fontSize:20,fontWeight:700,marginBottom:8,color:"#111827"},modalDesc:{fontSize:14,color:"#6B7280",marginBottom:24,lineHeight:1.5},inputLabel:{display:"block",marginBottom:6,fontWeight:500,fontSize:13,color:"#374151"},select:{width:"100%",padding:"10px 12px",borderRadius:8,border:"1px solid #D1D5DB",fontSize:14,outline:"none"},modalActions:{display:"flex",justifyContent:"flex-end",gap:12,marginTop:24}}}},function(e){e.O(0,[9613,2888,9774,179],function(){return e(e.s=92956)}),_N_E=e.O()}]);