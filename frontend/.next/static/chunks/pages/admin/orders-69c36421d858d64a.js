(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1426],{64998:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(91373).Z)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},9589:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(91373).Z)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},61108:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(91373).Z)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},87764:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(91373).Z)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},23450:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/orders",function(){return r(23756)}])},23756:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return D}});var n=r(85893),o=r(67294),i=r(11163),l=r(64552),s=r(42297),d=r(13025),a=r(87764),c=r(91373);let u=(0,c.Z)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),h=(0,c.Z)("activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);var p=r(64998),g=r(45077),x=r(61108);let y=(0,c.Z)("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);var f=r(9589),m=r(54976),E=r(28761),v=r(73510),b=r(28463),F=r(64248);function D(){let e=(0,i.useRouter)(),[t,r]=(0,o.useState)([]),[c,g]=(0,o.useState)(!0),[x,y]=(0,o.useState)(""),[f,m]=(0,o.useState)("ALL"),[E,v]=(0,o.useState)([]),[b,D]=(0,o.useState)(null);(0,o.useEffect)(()=>{I()},[]),(0,o.useEffect)(()=>{let e=()=>{if(t.length>0){let e=t.filter(e=>{var t,r;if(!["SHIPPED","ON_THE_WAY","OUT_FOR_DELIVERY","RTO_INITIATED"].includes(e.status)||!(null===(t=e.shipping)||void 0===t?void 0:t.awbNumber))return!1;let n=(null===(r=e.shipping)||void 0===r?void 0:r.lastSync)?new Date(e.shipping.lastSync).getTime():0;return Date.now()-n>9e5});if(e.length>0){let t=e.map(e=>e.orderId);console.log("Found stale orders, auto-refreshing:",t.length),A(t)}}};e();let r=setInterval(e,6e5);return()=>clearInterval(r)},[t.length]);let A=async e=>{v(t=>[...t,...e]);try{let t=localStorage.getItem("admin_token"),r=await fetch("".concat("","/api/orders/admin/orders/refresh-tracking"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({orderIds:e}),credentials:"include"});(await r.json()).success&&(D(new Date),I())}catch(e){console.error("Auto Refresh Failed:",e)}finally{v(t=>t.filter(t=>!e.includes(t)))}},I=async()=>{g(!0);try{let t=localStorage.getItem("admin_token"),n=await fetch("".concat("","/api/orders/admin/all?t=").concat(Date.now()),{headers:t?{Authorization:"Bearer ".concat(t)}:{},credentials:"include"}),o=await n.json();if(o.success){console.log("Admin Orders Fetched:",o.orders.length),o.orders.find(e=>"KASTURI-AA462ADB"===e.orderId)?console.log("✅ [FRONTEND] API Response INCLUDES Target Order"):console.warn("❌ [FRONTEND] API Response MISSING Target Order");let e=o.orders.sort((e,t)=>new Date(t.createdAt)-new Date(e.createdAt));r(e)}else console.error("Fetch Failed Logic:",o),"Not authorized"===o.message||o.message.includes("session")?(alert("Session expired. Please login again."),e.push("/admin/login")):alert("Failed to load orders: "+o.message)}catch(e){console.error("Orders Error:",e)}finally{g(!1)}},C=t.filter(e=>{var t,r,n,o;let i=e.orderId||"",l=i.toLowerCase().includes(x.toLowerCase())||(null===(r=e.customer)||void 0===r?void 0:null===(t=r.name)||void 0===t?void 0:t.toLowerCase().includes(x.toLowerCase()))||(null===(o=e.customer)||void 0===o?void 0:null===(n=o.phone)||void 0===n?void 0:n.includes(x)),s="ALL"===f||e.status===f;return"KASTURI-AA462ADB"===i&&console.log("\uD83D\uDD0D [FRONTEND] Filtering Target: SearchMatch=".concat(l,", StatusMatch=").concat(s," (").concat(e.status," vs ").concat(f,")")),l&&s});return(0,n.jsxs)(l.Z,{children:[(0,n.jsxs)("div",{style:S.header,children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{style:S.title,children:"Orders"}),(0,n.jsx)("p",{style:S.subtitle,children:"Manage and track all customer orders"})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:12},children:[b&&(0,n.jsxs)("div",{style:{fontSize:12,color:"#6B7280",alignSelf:"center"},children:["Last Synced: ",b.toLocaleTimeString()]}),(0,n.jsxs)("button",{onClick:()=>{let e=t.filter(e=>{var t;return(null===(t=e.shipping)||void 0===t?void 0:t.awbNumber)&&["SHIPPED","ON_THE_WAY","OUT_FOR_DELIVERY"].includes(e.status)}).map(e=>e.orderId);e.length>0?A(e):I()},style:S.exportBtn,children:[(0,n.jsx)(s.Z,{size:16})," Sync Live Status"]}),(0,n.jsxs)("button",{onClick:()=>{if(!C.length)return alert("No orders to export.");let e=["Order ID,Date,Customer Name,Phone,Amount,Payment,Status,Courier,AWB",...C.map(e=>{var t,r,n,o,i;return[e.orderId,new Date(e.createdAt).toLocaleDateString(),'"'.concat((null===(t=e.customer)||void 0===t?void 0:t.name)||"",'"'),(null===(r=e.customer)||void 0===r?void 0:r.phone)||"",(null===(n=e.pricing)||void 0===n?void 0:n.total)||0,e.paymentMethod,e.status,(null===(o=e.shipping)||void 0===o?void 0:o.courierName)||"",(null===(i=e.shipping)||void 0===i?void 0:i.awbNumber)||""]}).map(e=>e.join(","))].join("\n"),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(t),n=document.createElement("a");n.setAttribute("href",r),n.setAttribute("download","orders_export_".concat(new Date().toISOString().slice(0,10),".csv")),document.body.appendChild(n),n.click(),document.body.removeChild(n)},style:S.exportBtn,children:[(0,n.jsx)(d.Z,{size:16})," Export CSV"]})]})]}),(0,n.jsxs)("div",{style:S.controls,children:[(0,n.jsxs)("div",{style:S.searchBox,children:[(0,n.jsx)(a.Z,{size:18,color:"#6B7280"}),(0,n.jsx)("input",{type:"text",placeholder:"Search by Order ID, Name, Phone...",value:x,onChange:e=>y(e.target.value),style:S.searchInput})]}),(0,n.jsx)("div",{style:S.filterGroup,children:(0,n.jsxs)("select",{value:f,onChange:e=>m(e.target.value),style:S.select,children:[(0,n.jsx)("option",{value:"ALL",children:"All Status"}),(0,n.jsx)("option",{value:"PENDING_SHIPMENT",children:"New / Pending"}),(0,n.jsx)("option",{value:"PACKED",children:"Packed"}),(0,n.jsx)("option",{value:"SHIPPED",children:"Shipped"}),(0,n.jsx)("option",{value:"DELIVERED",children:"Delivered"}),(0,n.jsx)("option",{value:"CANCELLED",children:"Cancelled"}),(0,n.jsx)("option",{value:"RTO_INITIATED",children:"RTO Initiated"})]})})]}),(0,n.jsx)("div",{style:S.tableCard,children:(0,n.jsx)("div",{style:{overflowX:"auto"},children:c?(0,n.jsx)("div",{style:S.loadingState,children:"Loading Orders..."}):C.length>0?(0,n.jsxs)("table",{style:S.table,children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{style:S.thead,children:[(0,n.jsx)("th",{style:S.th,children:"Order ID"}),(0,n.jsx)("th",{style:S.th,children:"Date"}),(0,n.jsx)("th",{style:S.th,children:"Customer"}),(0,n.jsx)("th",{style:S.th,children:"Amount"}),(0,n.jsx)("th",{style:S.th,children:"Payment"}),(0,n.jsx)("th",{style:S.th,children:"Track"}),(0,n.jsx)("th",{style:S.th,children:"Status"}),(0,n.jsx)("th",{style:S.th,children:"Action"})]})}),(0,n.jsx)("tbody",{children:C.map(t=>{var r,o,i,l,d,a;return(0,n.jsxs)(F.E.tr,{style:S.tr,whileHover:{backgroundColor:"#F9FAFB"},onClick:()=>e.push("/admin/orders/".concat(t.orderId)),children:[(0,n.jsxs)("td",{style:S.tdPrimary,children:["#",t.orderId?t.orderId.substring(0,8).toUpperCase():"N/A","..."]}),(0,n.jsx)("td",{style:S.tdSec,children:(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,n.jsx)(u,{size:12}),new Date(t.createdAt).toLocaleDateString()]})}),(0,n.jsxs)("td",{style:S.td,children:[(0,n.jsx)("div",{style:{fontWeight:500},children:null===(r=t.customer)||void 0===r?void 0:r.name}),(0,n.jsx)("div",{style:{fontSize:12,color:"#6B7280"},children:null===(o=t.customer)||void 0===o?void 0:o.phone})]}),(0,n.jsxs)("td",{style:S.td,children:["₹",null===(i=t.pricing)||void 0===i?void 0:i.total]}),(0,n.jsx)("td",{style:S.td,children:(0,n.jsx)("span",{style:{...S.paymentBadge,background:"COD"===t.paymentMethod?"#FFF7ED":"#F3F4F6",color:"COD"===t.paymentMethod?"#C2410C":"#374151"},children:t.paymentMethod})}),(0,n.jsx)("td",{style:S.td,children:(null===(l=t.shipping)||void 0===l?void 0:l.awbNumber)?(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{fontSize:12,fontWeight:600,color:"#374151"},children:t.shipping.courierName||"Courier"}),(0,n.jsx)("div",{style:{fontSize:11,color:"#6B7280",fontFamily:"monospace"},children:t.shipping.awbNumber}),(0,n.jsxs)("div",{style:{fontSize:10,color:"#9CA3AF",display:"flex",alignItems:"center",gap:4,marginTop:2},children:[E.includes(t.orderId)?(0,n.jsx)(s.Z,{size:10,className:"spin"}):(0,n.jsx)(h,{size:10,color:t.shipping.lastSync?"#10B981":"#D1D5DB"}),E.includes(t.orderId)?"Syncing...":"Live"]})]}):(0,n.jsx)("span",{style:{fontSize:12,color:"#D1D5DB"},children:"-"})}),(0,n.jsx)("td",{style:S.td,children:(0,n.jsx)(j,{status:t.status,shippingStatus:null===(d=t.shipping)||void 0===d?void 0:d.shipmentStatus,lastSync:null===(a=t.shipping)||void 0===a?void 0:a.lastSync})}),(0,n.jsx)("td",{style:S.td,children:(0,n.jsx)("button",{style:S.actionBtn,children:(0,n.jsx)(p.Z,{size:18})})})]},t._id)})})]}):(0,n.jsx)("div",{style:S.emptyState,children:"No orders found matching your filters."})})})]})}let j=e=>{let{status:t,shippingStatus:r,lastSync:o}=e,i=null==t?void 0:t.replace(/_/g," "),l={bg:"#F3F4F6",color:"#4B5563",border:"#E5E7EB"},s=g.Z;if("CANCELLED"===t)l={bg:"#F3F4F6",color:"#9CA3AF",border:"#E5E7EB"},s=x.Z;else if("RTO_DELIVERED"===t)l={bg:"#FEF2F2",color:"#DC2626",border:"#FECACA"},s=y,i="RTO";else if("DELIVERED"===t)l={bg:"#ECFDF5",color:"#059669",border:"#A7F3D0"},s=f.Z;else if(r){let e=r.toLowerCase();e.includes("delivered")?(i="DELIVERED",l={bg:"#ECFDF5",color:"#059669",border:"#A7F3D0"},s=f.Z):e.includes("out for delivery")?(i="OFD",l={bg:"#FFFBEB",color:"#D97706",border:"#FDE68A"},s=m.Z):e.includes("transit")||e.includes("shipped")||e.includes("dispatched")?(i="SHIPPED",l={bg:"#EFF6FF",color:"#2563EB",border:"#BFDBFE"},s=E.Z):e.includes("pending")||e.includes("manifest")||e.includes("pickup")?(i="PENDING",l={bg:"#FEF9C3",color:"#CA8A04",border:"#FDE047"},s=g.Z):e.includes("rto")||e.includes("undelivered")||e.includes("returned")?(i="RTO",l={bg:"#FEF2F2",color:"#DC2626",border:"#FECACA"},s=y):(i=r,l={bg:"#F3F4F6",color:"#6B7280",border:"#E5E7EB"},s=v.Z)}else"SHIPPED"===t&&(l={bg:"#EFF6FF",color:"#2563EB",border:"#BFDBFE"},s=E.Z),"PACKED"===t&&(l={bg:"#FFFBEB",color:"#D97706",border:"#FDE68A"},s=b.Z,i="PACKED"),"PENDING_SHIPMENT"===t&&(l={bg:"#FEF9C3",color:"#CA8A04",border:"#FDE047"},s=g.Z,i="PENDING"),"RTO_INITIATED"===t&&(l={bg:"#FEF2F2",color:"#DC2626",border:"#FECACA"},s=y,i="RTO");return s||(s=g.Z),(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:2},children:[(0,n.jsxs)("span",{style:{padding:"4px 8px",paddingLeft:6,borderRadius:6,fontSize:11,fontWeight:700,textTransform:"uppercase",background:l.bg,color:l.color,border:"1px solid ".concat(l.border),display:"inline-flex",alignItems:"center",gap:5,letterSpacing:"0.02em",whiteSpace:"nowrap"},children:[(0,n.jsx)(s,{size:12,strokeWidth:2.5}),i]}),o&&r&&(0,n.jsxs)("span",{style:{fontSize:9,color:"#9CA3AF",marginLeft:2,display:"flex",alignItems:"center",gap:3},children:[(0,n.jsx)(h,{size:8})," ",new Date(o).getHours(),":",String(new Date(o).getMinutes()).padStart(2,"0")]})]})},S={header:{display:"flex",justifyContent:"space-between",alignItems:"flex-end",marginBottom:24},title:{fontSize:28,fontWeight:700,color:"#fff",margin:0,letterSpacing:"-0.5px"},subtitle:{fontSize:14,color:"#9CA3AF",marginTop:4},exportBtn:{display:"flex",alignItems:"center",gap:8,padding:"8px 16px",borderRadius:8,border:"1px solid #E5E7EB",background:"#fff",color:"#374151",cursor:"pointer",fontWeight:500},controls:{display:"flex",gap:12,marginBottom:24,flexWrap:"wrap"},searchBox:{display:"flex",alignItems:"center",gap:10,padding:"10px 16px",background:"#fff",border:"1px solid #E5E7EB",borderRadius:8,flex:1,minWidth:280},searchInput:{border:"none",outline:"none",width:"100%",fontSize:14},select:{padding:"10px 16px",borderRadius:8,border:"1px solid #E5E7EB",background:"#fff",outline:"none",fontSize:14,cursor:"pointer"},tableCard:{background:"#fff",borderRadius:12,border:"1px solid #E5E7EB",overflow:"hidden",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},table:{width:"100%",minWidth:900,borderCollapse:"collapse"},thead:{background:"#F9FAFB",borderBottom:"1px solid #E5E7EB"},th:{padding:"12px 24px",textAlign:"left",fontSize:12,fontWeight:600,color:"#6B7280",textTransform:"uppercase"},tr:{borderBottom:"1px solid #F3F4F6",cursor:"pointer",transition:"background 0.1s"},td:{padding:"16px 24px",fontSize:14,color:"#111827"},tdPrimary:{padding:"16px 24px",fontSize:14,color:"#4F46E5",fontWeight:600,fontFamily:"monospace"},tdSec:{padding:"16px 24px",fontSize:13,color:"#6B7280"},actionBtn:{background:"none",border:"none",cursor:"pointer",color:"#9CA3AF",padding:4},paymentBadge:{padding:"2px 8px",borderRadius:4,fontSize:11,fontWeight:600},loadingState:{padding:40,textAlign:"center",color:"#6B7280"},emptyState:{padding:40,textAlign:"center",color:"#6B7280"}}}},function(e){e.O(0,[9613,2888,9774,179],function(){return e(e.s=23450)}),_N_E=e.O()}]);