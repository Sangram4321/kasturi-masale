(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1358],{9589:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(91373).Z)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},61108:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(91373).Z)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},87764:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(91373).Z)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},54463:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(91373).Z)("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},44264:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/coins",function(){return s(67201)}])},67201:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return p}});var a=s(85893),r=s(67294),l=s(11163),n=s(9008),d=s.n(n),i=s(87764),c=s(54463),o=s(91373);let x=(0,o.Z)("coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]),m=(0,o.Z)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var u=s(9589),h=s(61108);let g=e=>{let{tier:t}=e,s={Bronze:"#CD7F32",Silver:"#C0C0C0",Gold:"#FFD700"};return(0,a.jsxs)("span",{style:{background:"".concat(s[t],"20"),color:"#FFD700"===s[t]?"#B45309":s[t],padding:"4px 12px",borderRadius:"20px",fontSize:"12px",fontWeight:"700",border:"1px solid ".concat(s[t],"40"),display:"inline-flex",alignItems:"center",gap:"4px"},children:["Gold"===t&&"\uD83D\uDC51"," ",t]})};function p(){var e,t;let s=(0,l.useRouter)(),[n,o]=(0,r.useState)(!0),[p,b]=(0,r.useState)(""),[y,j]=(0,r.useState)([]),[f,N]=(0,r.useState)(null),[v,w]=(0,r.useState)(null),[k,C]=(0,r.useState)("CREDIT"),[A,D]=(0,r.useState)(""),[S,E]=(0,r.useState)("MANUAL_REWARD"),[_,R]=(0,r.useState)(""),[T,I]=(0,r.useState)(""),[O,z]=(0,r.useState)(!1);(0,r.useEffect)(()=>{localStorage.getItem("admin_token")?o(!1):s.replace("/admin/login")},[]);let P=async e=>{if(e.preventDefault(),!(p.length<3))try{let e=localStorage.getItem("admin_token"),t=await fetch("/api/admin/wallet/users/search?query=".concat(p),{headers:{Authorization:"Bearer ".concat(e)}}),s=await t.json();s.success&&j(s.users)}catch(e){console.error(e)}},M=async e=>{N(e),j([]),b(""),await Z(e._id)},Z=async e=>{o(!0);try{let t=localStorage.getItem("admin_token"),s=await fetch("/api/admin/wallet/users/".concat(e),{headers:{Authorization:"Bearer ".concat(t)}}),a=await s.json();a.success&&w(a.wallet)}catch(e){console.error(e)}finally{o(!1)}},B=async e=>{if(e.preventDefault(),!A||A<=0)return alert("Enter valid amount");z(!0);try{let e=localStorage.getItem("admin_token"),t=await fetch("/api/admin/wallet/adjust",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({userId:f._id,type:k,amount:Number(A),reason:S,description:_||("CREDIT"===k?"Admin Reward":"Admin Correction"),adminNote:T})}),s=await t.json();s.success?(alert("Success!"),D(""),R(""),I(""),await Z(f._id)):alert(s.message)}catch(e){console.error(e),alert("Failed")}finally{z(!1)}},L=async(e,t)=>{if(confirm("Are you sure you want to mark this as ".concat(t,"? This cannot be undone.")))try{let s=localStorage.getItem("admin_token"),a=await fetch("/api/admin/wallet/resolve-pending",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify({transactionId:e,action:t})}),r=await a.json();r.success?await Z(f._id):alert(r.message)}catch(e){alert("Error resolving transaction")}};return n&&!f?(0,a.jsx)("div",{className:"p-10 text-center",children:"Loading Panel..."}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 text-gray-900 font-sans",children:[(0,a.jsx)(d(),{children:(0,a.jsx)("title",{children:"Coin Manager | Kasturi Admin"})}),(0,a.jsxs)("div",{className:"max-w-6xl mx-auto p-6",children:[(0,a.jsxs)("header",{className:"mb-8 flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Coin Adjustment Panel"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Secure Admin Access Only"})]}),(0,a.jsx)("button",{onClick:()=>s.push("/admin"),className:"text-sm font-medium text-gray-600 hover:text-black",children:"Back to Dashboard"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-400 uppercase mb-4",children:"Find User"}),(0,a.jsxs)("form",{onSubmit:P,className:"relative",children:[(0,a.jsx)("input",{type:"text",placeholder:"Search name, phone, email...",className:"w-full pl-10 pr-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-black",value:p,onChange:e=>b(e.target.value)}),(0,a.jsx)(i.Z,{className:"absolute left-3 top-3.5 text-gray-400",size:18})]}),y.length>0&&(0,a.jsx)("div",{className:"mt-2 bg-white border border-gray-200 rounded-lg shadow-lg overflow-hidden",children:y.map(e=>{var t;return(0,a.jsxs)("div",{onClick:()=>M(e),className:"p-3 hover:bg-gray-50 cursor-pointer border-b last:border-0 flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-xs font-bold",children:(null===(t=e.name)||void 0===t?void 0:t[0])||"?"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-sm",children:e.name||"Unknown"}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:e.email})]})]},e._id)})})]}),f&&(0,a.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100 relative overflow-hidden",children:[(0,a.jsx)("div",{className:"absolute top-0 right-0 p-4 opacity-10",children:(0,a.jsx)(c.Z,{size:100})}),(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,a.jsx)("div",{className:"w-16 h-16 rounded-full bg-black text-white flex items-center justify-center text-xl font-bold",children:null===(e=f.name)||void 0===e?void 0:e[0]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-bold",children:f.name}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:f.uid}),(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)(g,{tier:(null==v?void 0:v.tier)||"Bronze"})})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 mt-6",children:[(0,a.jsxs)("div",{className:"p-3 bg-green-50 rounded-lg border border-green-100",children:[(0,a.jsx)("div",{className:"text-xs text-green-700 font-semibold uppercase",children:"Active Coins"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-green-800",children:(null==v?void 0:v.balance)||0})]}),(0,a.jsxs)("div",{className:"p-3 bg-yellow-50 rounded-lg border border-yellow-100",children:[(0,a.jsx)("div",{className:"text-xs text-yellow-700 font-semibold uppercase",children:"Pending"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-yellow-800",children:(null==v?void 0:v.pendingBalance)||0})]})]})]})]}),(0,a.jsx)("div",{className:"lg:col-span-2 space-y-6",children:f?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[(0,a.jsxs)("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[(0,a.jsx)(x,{size:20,className:"text-gray-400"}),"Adjust Balance"]}),(0,a.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg text-sm text-blue-800 mb-6 flex gap-2",children:[(0,a.jsx)(m,{size:16,className:"mt-0.5"}),(0,a.jsxs)("span",{children:[(0,a.jsx)("strong",{children:"Admin Note:"})," All adjustments are logged in the immutable audit ledger. Do not use this for testing."]})]}),(0,a.jsxs)("form",{onSubmit:B,children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-semibold uppercase text-gray-500 mb-1",children:"Action"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>C("CREDIT"),className:"flex-1 py-2 rounded-lg font-medium text-sm border ".concat("CREDIT"===k?"bg-green-600 text-white border-green-600":"bg-white text-gray-600 border-gray-200"),children:"+ Add Coins"}),(0,a.jsx)("button",{type:"button",onClick:()=>C("DEBIT"),className:"flex-1 py-2 rounded-lg font-medium text-sm border ".concat("DEBIT"===k?"bg-red-600 text-white border-red-600":"bg-white text-gray-600 border-gray-200"),children:"- Deduct"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-semibold uppercase text-gray-500 mb-1",children:"Amount"}),(0,a.jsx)("input",{type:"number",className:"w-full p-2 border border-gray-300 rounded-lg",value:A,onChange:e=>D(e.target.value),placeholder:"0"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-semibold uppercase text-gray-500 mb-1",children:"Reason Code"}),(0,a.jsxs)("select",{className:"w-full p-2 border border-gray-300 rounded-lg bg-white",value:S,onChange:e=>E(e.target.value),children:[(0,a.jsx)("option",{value:"MANUAL_REWARD",children:"Manual Reward"}),(0,a.jsx)("option",{value:"CUSTOMER_SUPPORT",children:"Customer Support"}),(0,a.jsx)("option",{value:"ORDER_CORRECTION",children:"Order Correction"}),(0,a.jsx)("option",{value:"REFUND_ADJUSTMENT",children:"Refund Adjustment"}),(0,a.jsx)("option",{value:"PROMOTIONAL_GRANT",children:"Promotional Grant"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-semibold uppercase text-gray-500 mb-1",children:"Public Description (User sees this)"}),(0,a.jsx)("input",{type:"text",className:"w-full p-2 border border-gray-300 rounded-lg",value:_,onChange:e=>R(e.target.value),placeholder:"CREDIT"===k?"Loyalty Bonus":"Order Cancellation"})]})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-xs font-semibold uppercase text-gray-500 mb-1",children:"Internal Admin Note (Private)"}),(0,a.jsx)("textarea",{className:"w-full p-2 border border-gray-300 rounded-lg h-20 text-sm",value:T,onChange:e=>I(e.target.value),placeholder:"Explain why this adjustment is being made..."})]}),(0,a.jsx)("button",{type:"submit",disabled:O,className:"w-full bg-black text-white py-3 rounded-lg font-semibold hover:bg-gray-800 disabled:opacity-50",children:O?"Processing...":"Confirm ".concat(k," Adjustment")})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-gray-100 bg-gray-50 flex justify-between items-center",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-700",children:"Audit Ledger"}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"Read-only immutable record"})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,a.jsx)("thead",{className:"text-xs text-gray-500 uppercase bg-gray-50 border-b",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3",children:"Date"}),(0,a.jsx)("th",{className:"px-4 py-3",children:"Description"}),(0,a.jsx)("th",{className:"px-4 py-3",children:"Type"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right",children:"Amount"}),(0,a.jsx)("th",{className:"px-4 py-3 text-center",children:"Status"}),(0,a.jsx)("th",{className:"px-4 py-3",children:"Admin"})]})}),(0,a.jsx)("tbody",{children:null==v?void 0:null===(t=v.history)||void 0===t?void 0:t.map(e=>{var t;return(0,a.jsxs)("tr",{className:"border-b last:border-0 hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-4 py-3 text-gray-500",children:new Date(e.createdAt).toLocaleString()}),(0,a.jsxs)("td",{className:"px-4 py-3",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:e.description}),e.adminNote&&(0,a.jsx)("div",{className:"text-xs text-gray-400 italic",children:e.adminNote})]}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)("span",{className:"text-xs font-bold px-2 py-1 rounded ".concat("CREDIT"===e.type?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:e.type})}),(0,a.jsxs)("td",{className:"px-4 py-3 text-right font-bold ".concat("CREDIT"===e.type?"text-green-600":"text-red-600"),children:["CREDIT"===e.type?"+":"-",e.amount]}),(0,a.jsx)("td",{className:"px-4 py-3 text-center",children:"PENDING"===e.status?(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,a.jsx)("span",{className:"text-yellow-600 font-bold text-xs uppercase",children:"Pending"}),(0,a.jsx)("button",{onClick:()=>L(e._id,"COMPLETED"),className:"p-1 hover:bg-green-100 rounded text-green-600",title:"Resolve as Complete",children:(0,a.jsx)(u.Z,{size:16})}),(0,a.jsx)("button",{onClick:()=>L(e._id,"VOID"),className:"p-1 hover:bg-red-100 rounded text-red-600",title:"Void Transaction",children:(0,a.jsx)(h.Z,{size:16})})]}):(0,a.jsx)("span",{className:"text-xs font-bold ".concat("COMPLETED"===e.status?"text-green-600":"text-gray-400"),children:e.status})}),(0,a.jsx)("td",{className:"px-4 py-3 text-xs text-gray-500",children:(null===(t=e.adminId)||void 0===t?void 0:t.username)||"-"})]},e._id)})})]})})]})]}):(0,a.jsx)("div",{className:"h-64 flex items-center justify-center bg-white rounded-xl border border-dashed border-gray-300 text-gray-400",children:"Select a user to view wallet details"})})]})]})]})}}},function(e){e.O(0,[2888,9774,179],function(){return e(e.s=44264)}),_N_E=e.O()}]);