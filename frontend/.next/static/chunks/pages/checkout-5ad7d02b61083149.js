(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2222],{55248:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/checkout",function(){return i(17803)}])},17803:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return x}});var n=i(85893),r=i(67294),o=i(89508),a=i(64248),s=i(11163),l=i(67567);function d(e){let{onAnimationCommit:t,isLoading:i,isValid:o,label:a}=e,[s,l]=(0,r.useState)(!1);return(0,n.jsxs)("button",{className:"order-truck-button ".concat(s?"animate":""),onClick:()=>{!o||i||s||(l(!0),setTimeout(()=>{l(!1),t&&t()},1e4))},disabled:!o||i||s,style:{opacity:o?1:.6,pointerEvents:o&&!s?"all":"none"},children:[(0,n.jsx)("span",{className:"default",children:s?"Sending...":a}),(0,n.jsxs)("span",{className:"success",children:["Order Placed",(0,n.jsx)("svg",{viewBox:"0 0 12 10",children:(0,n.jsx)("polyline",{points:"1.5 6 4.5 9 10.5 1"})})]}),(0,n.jsx)("div",{className:"box"}),(0,n.jsxs)("div",{className:"truck",children:[(0,n.jsx)("div",{className:"back"}),(0,n.jsx)("div",{className:"front",children:(0,n.jsx)("div",{className:"window"})}),(0,n.jsx)("div",{className:"light top"}),(0,n.jsx)("div",{className:"light bottom"})]}),(0,n.jsx)("div",{className:"lines"})]})}let c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;"undefined"!=typeof navigator&&navigator.vibrate&&navigator.vibrate(e)},p=()=>(0,n.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,n.jsx)("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),(0,n.jsx)("polyline",{points:"14 2 14 8 20 8"}),(0,n.jsx)("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),(0,n.jsx)("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),(0,n.jsx)("polyline",{points:"10 9 9 9 8 9"})]}),h=()=>(0,n.jsxs)("svg",{width:"40",height:"40",viewBox:"0 0 100 100",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,n.jsx)("rect",{width:"100",height:"100",rx:"20",fill:"#F8FAFC"}),(0,n.jsx)("path",{d:"M25 35 V55 C25 65 35 70 50 70 C65 70 75 65 75 55 V35",stroke:"#16a34a",strokeWidth:"8",strokeLinecap:"round",strokeLinejoin:"round"}),(0,n.jsx)("path",{d:"M40 50 L50 60 L60 50",stroke:"#16a34a",strokeWidth:"8",strokeLinecap:"round",strokeLinejoin:"round"}),(0,n.jsx)("text",{x:"50",y:"25",fontSize:"14",textAnchor:"middle",fill:"#64748B",fontWeight:"bold",fontFamily:"sans-serif",letterSpacing:"1",children:"UPI"})]}),u=()=>(0,n.jsxs)("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,n.jsx)("rect",{width:"24",height:"24",rx:"6",fill:"#F0FDF4"}),(0,n.jsx)("path",{d:"M17 9V7C17 5.89543 16.1046 5 15 5H5C3.89543 5 3 5.89543 3 7V17C3 18.1046 3.89543 19 5 19H15C16.1046 19 17 18.1046 17 17V15M17 15H19C20.1046 15 21 14.1046 21 13V11C21 9.89543 20.1046 9 19 9H17M17 15V9",stroke:"#15803d",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,n.jsx)("circle",{cx:"10",cy:"12",r:"2",fill:"#15803d",fillOpacity:"0.2",stroke:"#15803d",strokeWidth:"1.5"})]});function x(){let e=(0,s.useRouter)(),{cart:t,clearCart:x,hydrated:m}=(0,l.j)(),[j,b]=(0,r.useState)(!1),[v,w]=(0,r.useState)(!1),[C,F]=(0,r.useState)("cod"),[S,k]=(0,r.useState)(null),[E,D]=(0,r.useState)(null),[B,R]=(0,r.useState)(""),[z,T]=(0,r.useState)(!1),[I,O]=(0,r.useState)({name:"",phone:"+91",address:"",pincode:""}),[_,N]=(0,r.useState)(!1),[P,A]=(0,r.useState)(0),[W,M]=(0,r.useState)(null),[L,H]=(0,r.useState)(""),[V,J]=(0,r.useState)(0),[q,U]=(0,r.useState)(null);(0,r.useEffect)(()=>{N(!0);let i=localStorage.getItem("redeemCoins");i&&A(parseInt(i));let n=localStorage.getItem("user");n&&M(JSON.parse(n)),m&&0===t.length&&!j&&e.replace("/cart")},[t,j,e,m]);let G=e=>O({...I,[e.target.name]:e.target.value}),K=t.reduce((e,t)=>e+t.price*t.qty,0),X=Math.floor(.8*P),Q=K-X-V,Y=K>=500?0:50,Z=("cod"===C?Q+40:Q)+Y,$=t.length>0&&I.name.length>2&&I.phone.length>=10&&I.address.length>5&&I.pincode.length>=6,ee=async()=>{w(!0);try{let e={customer:I,items:t.map(e=>({variant:e.variant,quantity:e.qty,price:e.price})),paymentMethod:"cod"===C?"COD":"UPI",pricing:{subtotal:K,codFee:"cod"===C?40:0,shippingFee:Y,total:Z},userId:W?W.uid:null,redeemCoins:P,referralCode:V>0?L:null};if("cod"===C){let t;let i=await fetch("".concat("","/api/orders/create"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),n=await i.text();try{t=JSON.parse(n)}catch(e){throw console.error("JSON PARSE ERROR:",n),Error("Server Error: "+(n.substring(0,100)||"Unknown Error"))}if(!i.ok||!t.success)throw Error((null==t?void 0:t.message)||"Order failed");et(t)}else{let t;let i=await fetch("".concat("","/api/orders/create-payment"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:Z})}),n=await i.text();try{t=JSON.parse(n)}catch(e){throw Error("Payment Init Failed: "+n.substring(0,50))}if(!t.success)throw Error("Payment initialization failed");let r={key:"rzp_live_S5M9xFQnjbs34t",amount:t.order.amount,currency:"INR",name:"Kasturi Masale",description:"Authentic Kolhapuri Masale",image:"/images/logo.png",order_id:t.order.id,handler:async function(t){try{let i;let n=await fetch("".concat("","/api/orders/verify-payment"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({razorpay_order_id:t.razorpay_order_id,razorpay_payment_id:t.razorpay_payment_id,razorpay_signature:t.razorpay_signature,orderData:e})}),r=await n.text();try{i=JSON.parse(r)}catch(e){throw Error("Verification Failed: "+r.substring(0,50))}i.success?et(i):(alert("Payment verification failed! Please contact support."),w(!1))}catch(e){console.error(e),alert("Payment verified but order creation failed. Contact support with Payment ID: "+t.razorpay_payment_id),w(!1)}},prefill:{name:I.name,email:"",contact:I.phone},theme:{color:"#C02729"}},o=new window.Razorpay(r);o.on("payment.failed",function(e){alert(e.error.description),w(!1)}),o.open()}}catch(e){console.error(e),alert(e.message||"Connection failed. Please try again."),w(!1)}},et=e=>{k(e.orderId),D(e.whatsappLink),localStorage.removeItem("redeemCoins"),"function"==typeof window.gtag&&window.gtag("event","purchase",{transaction_id:e.orderId,value:Z,currency:"INR",items:t.map(e=>({item_id:e.variant,item_name:e.name||e.variant,price:e.price,quantity:e.qty}))}),Promise.resolve().then(i.bind(i,35238)).then(e=>{let{feedback:t}=e;return t.trigger("success")}),x(),b(!0)};return((0,r.useEffect)(()=>{j&&E&&setTimeout(()=>window.open(E,"_blank"),600),j&&setTimeout(()=>e.push("/"),4e3)},[j,E,e]),_)?(0,n.jsx)("main",{style:f.page,children:(0,n.jsx)(o.M,{mode:"wait",children:j?(0,n.jsxs)(a.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},style:f.successCard,children:[(0,n.jsx)("div",{style:f.confetti,children:"\uD83C\uDF89"}),(0,n.jsx)("h2",{style:f.successTitle,children:"Order Placed!"}),(0,n.jsxs)("p",{style:{color:"#4B5563",margin:"8px 0 24px"},children:["Order ID: ",(0,n.jsxs)("strong",{children:["#",S]})]}),(0,n.jsxs)("div",{style:{background:"#FFFAEA",border:"1px dashed #FCD34D",borderRadius:12,padding:"12px",marginBottom:24,color:"#B45309",fontWeight:600,fontSize:14},children:[(0,n.jsx)("span",{style:{fontSize:18,marginRight:8},children:"\uD83E\uDE99"}),"You earned ",(0,n.jsxs)("strong",{children:[Math.floor(.05*Z)," Kasturi Coins"]}),"!"]}),(0,n.jsx)("div",{style:f.whatsappBox,children:"Check WhatsApp for confirmation & tracking details."}),(0,n.jsx)("button",{onClick:()=>e.push("/orders"),style:{marginTop:24,background:"none",border:"none",color:"#4B5563",fontWeight:600,cursor:"pointer",textDecoration:"underline"},children:"View My Orders"})]},"success"):(0,n.jsxs)(a.E.div,{initial:{opacity:0,scale:.98,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,filter:"blur(4px)"},transition:{duration:.4,ease:"easeOut"},style:f.card,children:[(0,n.jsx)("header",{style:f.header,children:(0,n.jsxs)("div",{style:f.headerTitleRow,children:[(0,n.jsx)("div",{style:f.iconBox,children:(0,n.jsx)(p,{})}),(0,n.jsx)("h1",{style:f.title,children:"Checkout"})]})}),(0,n.jsxs)("div",{style:f.scrollContent,children:[(0,n.jsxs)("section",{style:f.section,children:[(0,n.jsx)("h3",{style:f.sectionTitle,children:"1. Delivery Details"}),(0,n.jsxs)("div",{style:f.inputGrid,children:[(0,n.jsx)(g,{name:"name",placeholder:"Full Name",value:I.name,onChange:G,autoFocus:!0}),(0,n.jsx)(g,{name:"phone",placeholder:"Phone Number",type:"tel",value:I.phone,onChange:G}),(0,n.jsx)(g,{name:"pincode",placeholder:"Pincode",type:"number",value:I.pincode,onChange:G}),(0,n.jsx)("textarea",{name:"address",placeholder:"Complete Address (House No, Street, Area)",value:I.address,onChange:G,style:f.textarea})]})]}),(0,n.jsxs)("section",{style:f.section,children:[(0,n.jsx)("h3",{style:f.sectionTitle,children:"2. Payment Method"}),(0,n.jsxs)("div",{style:f.receipt,children:[(0,n.jsxs)("div",{style:f.receiptRow,children:[(0,n.jsx)("span",{children:"Item Total"})," ",(0,n.jsxs)("b",{children:["₹",K]})]}),X>0&&(0,n.jsxs)("div",{style:{...f.receiptRow,color:"#166534",fontWeight:600},children:[(0,n.jsxs)("span",{children:["Loyalty Discount (",P," coins)"]}),(0,n.jsxs)("span",{children:["- ₹",X]})]}),V>0&&(0,n.jsxs)("div",{style:{...f.receiptRow,color:"#166534",fontWeight:600},children:[(0,n.jsx)("span",{children:"Referral Discount"}),(0,n.jsxs)("span",{children:["- ₹",V]})]}),"cod"===C&&(0,n.jsxs)(a.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},style:f.receiptRow,children:[(0,n.jsx)("span",{style:{color:"#D97706"},children:"+ COD Handling"})," ",(0,n.jsxs)("b",{style:{color:"#D97706"},children:["₹",40]})]}),(0,n.jsxs)("div",{style:f.receiptRow,children:[(0,n.jsx)("span",{children:"Delivery Charge"}),(0,n.jsx)("b",{style:{color:0===Y?"#166534":"inherit"},children:0===Y?"FREE":"₹".concat(Y)})]}),(0,n.jsx)("div",{style:{fontSize:11,color:"#6B7280",marginTop:-6,marginBottom:8,textAlign:"right"},children:Y>0?"Shipping ₹".concat(Y," applied (Free above ₹500)"):"Free Shipping applied (Order above ₹500)"}),(0,n.jsx)("div",{style:f.divider}),(0,n.jsxs)("div",{style:f.totalRow,children:[(0,n.jsx)("span",{children:"Total Payable"}),(0,n.jsxs)("span",{style:{fontSize:24,color:"#C02729"},children:["₹",Z]})]})]}),(0,n.jsxs)("div",{style:f.payGrid,children:[(0,n.jsx)(y,{selected:"cod"===C,onClick:()=>F("cod"),icon:(0,n.jsx)(u,{}),title:"Cash on Delivery",desc:"Pay ₹".concat(Z," at your doorstep")}),(0,n.jsx)(y,{selected:"upi"===C,onClick:()=>F("upi"),icon:(0,n.jsx)(h,{}),title:"Pay Online / UPI",desc:"Save time, no cash hassle"})]}),(0,n.jsx)("div",{style:f.divider}),(0,n.jsx)("div",{style:{marginTop:24},children:z?(0,n.jsxs)("div",{style:f.couponBox,children:[(0,n.jsxs)("div",{style:{flex:1,display:"flex",alignItems:"center",gap:8},children:[(0,n.jsx)("span",{style:{fontSize:18},children:"\uD83C\uDF9F️"}),(0,n.jsx)("input",{type:"text",placeholder:"Referral / Coupon Code",style:f.couponInput,value:L,onChange:e=>H(e.target.value.toUpperCase()),disabled:V>0})]}),V>0?(0,n.jsx)("button",{style:{...f.applyBtn,background:"#166534"},onClick:()=>{H(""),J(0),U(null)},children:"Applied ✓"}):(0,n.jsx)("button",{style:f.applyBtn,onClick:async()=>{if(!(L.length<3)){U({loading:!0,message:"Checking..."});try{let e=await fetch("".concat("","/api/user/validate-referral"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:L,uid:W?W.uid:null,cartTotal:K,phone:I.phone,address:I.address})}),t=await e.json();t.success?(J(t.discount),U({success:!0,message:"Referral Applied! saved ₹".concat(t.discount)})):U({success:!1,message:t.message})}catch(e){U({success:!1,message:"Validation error"})}}},children:"Apply"})]}):(0,n.jsx)("button",{onClick:()=>T(!0),style:{background:"none",border:"none",color:"#6B7280",fontSize:13,textDecoration:"underline",cursor:"pointer",padding:0},children:"Have a coupon or referral code?"})}),q&&(0,n.jsx)("div",{style:{fontSize:12,marginTop:8,color:q.success?"#166534":"#C02729",padding:"0 4px",display:"flex",alignItems:"center",gap:4},children:q.message})]})]}),(0,n.jsxs)("div",{style:f.footer,children:[(0,n.jsx)(d,{onAnimationCommit:()=>{c(50),ee()},isLoading:v,isValid:$,label:"cod"===C?"Place Order (Pay ₹".concat(Z," on Delivery)"):"Pay ₹".concat(Z," & Place Order")}),(0,n.jsx)("div",{style:f.trustBadge,children:"\uD83D\uDD12 Secure Checkout"})]})]},"checkout-wrapper")})}):null}let g=e=>(0,n.jsx)("input",{...e,style:f.input}),y=e=>{let{selected:t,onClick:i,icon:r,title:o,desc:s}=e;return(0,n.jsxs)(a.E.div,{onClick:i,animate:{borderColor:t?"#C02729":"#E5E7EB",backgroundColor:t?"#FFF1F2":"#FFFFFF",boxShadow:t?"0 4px 12px rgba(192, 39, 41, 0.1)":"none"},style:f.payOption,children:[(0,n.jsx)("div",{style:f.radio,children:t&&(0,n.jsx)("div",{style:f.radioDot})}),(0,n.jsxs)("div",{style:{flex:1},children:[(0,n.jsxs)("div",{style:f.payHeader,children:[(0,n.jsx)("span",{style:f.payTitle,children:o}),r]}),(0,n.jsx)("div",{style:f.payDesc,children:s})]})]})},f={page:{minHeight:"100vh",background:"#F3F4F6",fontFamily:"'Inter', sans-serif",display:"flex",justifyContent:"center",alignItems:"flex-start",padding:"16px 12px"},card:{width:"100%",maxWidth:500,background:"#fff",borderRadius:24,boxShadow:"0 20px 60px -10px rgba(0,0,0,0.1)",overflow:"hidden",position:"relative",marginTop:0,margin:"0 auto"},header:{padding:"24px 24px 0",display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},headerTitleRow:{display:"flex",alignItems:"center",gap:12},iconBox:{width:40,height:40,borderRadius:12,background:"#F3F4F6",display:"flex",alignItems:"center",justifyContent:"center",color:"#374151"},title:{fontSize:22,fontWeight:"800",margin:0,color:"#111827"},scrollContent:{padding:"0 24px 24px"},section:{marginBottom:32},sectionTitle:{fontSize:13,fontWeight:"700",textTransform:"uppercase",color:"#9CA3AF",marginBottom:16,letterSpacing:"1px"},couponBox:{background:"#fff",padding:20,borderRadius:"var(--border-radius-md)",border:"1px dashed var(--color-brand-red)",marginTop:24,display:"flex",gap:12,alignItems:"center",backgroundColor:"var(--color-bg-cream)",flexWrap:"wrap"},couponInput:{flex:1,padding:"12px 16px",borderRadius:8,border:"1px solid rgba(0,0,0,0.1)",fontSize:14,fontFamily:"var(--font-body)",outline:"none"},applyBtn:{padding:"12px 24px",background:"var(--color-text-dark)",color:"#fff",border:"none",borderRadius:8,fontWeight:600,cursor:"pointer",fontSize:14},inputGrid:{display:"flex",flexDirection:"column",gap:12},input:{width:"100%",padding:"16px",borderRadius:16,border:"1px solid #E5E7EB",background:"#FFFFFF",fontSize:15,fontWeight:"500",color:"#1F2937",outline:"none",transition:"border-color 0.2s"},textarea:{width:"100%",padding:"16px",borderRadius:16,border:"1px solid #E5E7EB",background:"#FFFFFF",fontSize:15,fontWeight:"500",color:"#1F2937",outline:"none",minHeight:80,fontFamily:"inherit",resize:"none"},receipt:{padding:20,borderRadius:20,background:"#FAFAFA",border:"1px solid #F3F4F6",marginBottom:20},receiptRow:{display:"flex",justifyContent:"space-between",marginBottom:8,fontSize:14,color:"#4B5563"},divider:{height:1,background:"#E5E7EB",margin:"12px 0"},totalRow:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:16,fontWeight:"700",color:"#111827"},payGrid:{display:"flex",flexDirection:"column",gap:12},payOption:{display:"flex",alignItems:"center",gap:16,padding:16,borderRadius:18,border:"2px solid #E5E7EB",cursor:"pointer",background:"#fff"},radio:{width:20,height:20,borderRadius:"50%",border:"2px solid #D1D5DB",display:"flex",alignItems:"center",justifyContent:"center"},radioDot:{width:10,height:10,borderRadius:"50%",background:"#C02729"},payHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4},payTitle:{fontWeight:"700",fontSize:15,color:"#1F2937"},payDesc:{fontSize:12,color:"#6B7280"},footer:{padding:24,borderTop:"1px solid #F3F4F6",background:"#fff",boxShadow:"0 -10px 40px rgba(0,0,0,0.03)",position:"relative",zIndex:10},trustBadge:{textAlign:"center",fontSize:11,color:"#9CA3AF",marginTop:12,display:"flex",alignItems:"center",justifyContent:"center",gap:6},successCard:{background:"#fff",padding:40,borderRadius:32,textAlign:"center",maxWidth:400,boxShadow:"0 20px 60px rgba(0,0,0,0.1)"},confetti:{fontSize:40,marginBottom:10},successTitle:{fontSize:28,fontWeight:"800",color:"#111827",margin:0},whatsappBox:{background:"#DCFCE7",color:"#166534",padding:12,borderRadius:12,fontSize:13,fontWeight:"600"}}}},function(e){e.O(0,[2888,9774,179],function(){return e(e.s=55248)}),_N_E=e.O()}]);